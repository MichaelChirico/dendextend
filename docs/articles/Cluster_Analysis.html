<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hierarchical cluster analysis on famous data sets - enhanced with the _dendextend_ package • dendextend</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical cluster analysis on famous data sets - enhanced with the _dendextend_ package">
<meta property="og:description" content="dendextend">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dendextend</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.14.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dendextend.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Cluster_Analysis.html">Hierarchical cluster analysis on famous data sets - enhanced with the _dendextend_ package</a>
    </li>
    <li>
      <a href="../articles/FAQ.html">Frequently asked questions</a>
    </li>
    <li>
      <a href="../articles/Quick_Introduction.html">Quick Introduction</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/talgalili/dendextend/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hierarchical cluster analysis on famous data sets - enhanced with the <em>dendextend</em> package</h1>
                        <h4 class="author">Tal Galili</h4>
            
            <h4 class="date">2020-08-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/talgalili/dendextend/blob/master/vignettes/Cluster_Analysis.Rmd"><code>vignettes/Cluster_Analysis.Rmd</code></a></small>
      <div class="hidden name"><code>Cluster_Analysis.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Hierarchical cluster analysis on famous data sets}
-->
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This document demonstrates, on several famous data sets, how the <em>dendextend</em> R package can be used to enhance Hierarchical Cluster Analysis (through better visualization and sensitivity analysis).</p>
</div>
<div id="iris---edgar-andersons-iris-data" class="section level2">
<h2 class="hasAnchor">
<a href="#iris---edgar-andersons-iris-data" class="anchor"></a>iris - Edgar Anderson’s Iris Data</h2>
<div id="background" class="section level3">
<h3 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h3>
<blockquote>
<p>The famous (Fisher’s or Anderson’s) iris data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica. (from <code><a href="https://rdrr.io/r/datasets/iris.html">?iris</a></code>)</p>
</blockquote>
<p>The <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set">Iris flower data set</a> is fun for learning supervised classification algorithms, and is known as a difficult case for unsupervised learning. This is easily seen through the following Scatter Plot Matrix (SPLOM):</p>
<p>Define variables:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">&lt;-</span> <span class="kw pkg">datasets</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/r/datasets/iris.html">iris</a></span>
<span class="no">iris2</span> <span class="kw">&lt;-</span> <span class="no">iris</span>[,-<span class="fl">5</span>]
<span class="no">species_labels</span> <span class="kw">&lt;-</span> <span class="no">iris</span>[,<span class="fl">5</span>]
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">colorspace</span>) <span class="co"># get nice colors</span>
<span class="no">species_col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/rainbow_hcl.html">rainbow_hcl</a></span>(<span class="fl">3</span>))[<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">species_labels</span>)]</pre></body></html></div>
<p>SPLOM:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Plot a SPLOM:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span>(<span class="no">iris2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">species_col</span>,
      <span class="kw">lower.panel</span> <span class="kw">=</span> <span class="kw">NULL</span>,
       <span class="kw">cex.labels</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">19</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1.2</span>)

<span class="co"># Add a legend</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">xpd</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">2</span>,
   <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">species_labels</span>)),
    <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">species_col</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">xpd</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-3-1.png" width="675"></p>
<p>We can see that the <em>Setosa</em> species are distinctly different from <em>Versicolor</em> and <em>Virginica</em> (they have lower petal length and width). But <em>Versicolor</em> and <em>Virginica</em> cannot easily be separated based on measurements of their sepal and petal width/length.</p>
<p>The same conclusion can be made by looking at the parallel coordinates plot of the data:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># http://blog.safaribooksonline.com/2014/03/31/mastering-parallel-coordinate-charts-r/</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">las</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.5</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>) + <span class="fl">0.1</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">.8</span>)
<span class="kw pkg">MASS</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/parcoord.html">parcoord</a></span>(<span class="no">iris2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">species_col</span>, <span class="kw">var.label</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># Add Title</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Parallel coordinates plot of the Iris data"</span>)
<span class="co"># Add a legend</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">xpd</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.75</span>, <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">.25</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1</span>,
   <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">species_labels</span>)),
    <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">species_col</span>), <span class="kw">horiz</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-4-1.png" width="450"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">xpd</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
</div>
<div id="the-3-clusters-from-the-complete-method-vs-the-real-species-category" class="section level3">
<h3 class="hasAnchor">
<a href="#the-3-clusters-from-the-complete-method-vs-the-real-species-category" class="anchor"></a>The 3 clusters from the “complete” method vs the real species category</h3>
<p>The default hierarchical clustering method in <code>hclust</code> is “complete”. We can visualize the result of running it by turning the object to a dendrogram and making several adjustments to the object, such as: changing the labels, coloring the labels based on the real species category, and coloring the branches based on cutting the tree into three clusters.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">d_iris</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="no">iris2</span>) <span class="co"># method="man" # is a bit better</span>
<span class="no">hc_iris</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="no">d_iris</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"complete"</span>)
<span class="no">iris_species</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">iris</span>[,<span class="fl">5</span>]))

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dendextend</span>)
<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span>(<span class="no">hc_iris</span>)
<span class="co"># order it the closest we can to the order of the observations:</span>
<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="no">dend</span>, <span class="fl">1</span>:<span class="fl">150</span>)

<span class="co"># Color the branches based on the clusters:</span>
<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="no">dend</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>) <span class="co">#, groupLabels=iris_species)</span>

<span class="co"># Manually match the labels, as much as possible, to the real classification of the flowers:</span>
<span class="fu"><a href="../reference/labels_colors.html">labels_colors</a></span>(<span class="no">dend</span>) <span class="kw">&lt;-</span>
   <span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/rainbow_hcl.html">rainbow_hcl</a></span>(<span class="fl">3</span>)[<span class="fu"><a href="../reference/sort_levels_values.html">sort_levels_values</a></span>(
      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">iris</span>[,<span class="fl">5</span>])[<span class="fu"><a href="https://rdrr.io/r/stats/order.dendrogram.html">order.dendrogram</a></span>(<span class="no">dend</span>)]
   )]

<span class="co"># We shall add the flower type to the labels:</span>
<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">dend</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">iris</span>[,<span class="fl">5</span>])[<span class="fu"><a href="https://rdrr.io/r/stats/order.dendrogram.html">order.dendrogram</a></span>(<span class="no">dend</span>)],
                           <span class="st">"("</span>,<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">dend</span>),<span class="st">")"</span>,
                           <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="co"># We hang the dendrogram a bit:</span>
<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/hang.dendrogram.html">hang.dendrogram</a></span>(<span class="no">dend</span>,<span class="kw">hang_height</span><span class="kw">=</span><span class="fl">0.1</span>)
<span class="co"># reduce the size of the labels:</span>
<span class="co"># dend &lt;- assign_values_to_leaves_nodePar(dend, 0.5, "lab.cex")</span>
<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="no">dend</span>, <span class="st">"labels_cex"</span>, <span class="fl">0.5</span>)
<span class="co"># And plot:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">7</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">dend</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Clustered Iris data set
     (the labels give the true flower species)"</span>,
     <span class="kw">horiz</span> <span class="kw">=</span>  <span class="fl">TRUE</span>,  <span class="kw">nodePar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">cex</span> <span class="kw">=</span> <span class="fl">.007</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topleft"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="no">iris_species</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/rainbow_hcl.html">rainbow_hcl</a></span>(<span class="fl">3</span>))</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-5-1.png" width="525"></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">#### BTW, notice that:
# labels(hc_iris) # no labels, because "iris" has no row names
# is.integer(labels(dend)) # this could cause problems...
# is.character(labels(dend)) # labels are no longer "integer"</pre></body></html></div>
<p>The same can be presented in a circular layout:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Requires that the circlize package will be installed</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="fl">4</span>))
<span class="fu"><a href="../reference/circlize_dendrogram.html">circlize_dendrogram</a></span>(<span class="no">dend</span>)</pre></body></html></div>
<pre><code>## Loading required namespace: circlize</code></pre>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-6-1.png" width="525"></p>
<p>These visualizations easily demonstrates how the separation of the hierarchical clustering is very good with the “Setosa” species, but misses in labeling many “Versicolor” species as “Virginica”.</p>
<p>The hanging of the tree also helps to locate extreme observations. For example, we can see that observation “virginica (107)” is not very similar to the Versicolor species, but still, it is among them. Also, “Versicolor (71)” is located too much “within” the group of Virginica flowers.</p>
<p>We can also explore the data using a heatmap. The rows are ordered based on the order of the hierarchical clustering (using the “complete” method). The colored bar indicates the species category each row belongs to. The color in the heatmap indicates the length of each measurement (from light yellow to dark red).</p>
<p>In the heatmap we also see how the Setosa species has low petal values (in light yellow), but it is very difficult to see any clear distinction between the other two species.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">some_col_func</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">n</span>) <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw pkg">colorspace</span><span class="kw ns">::</span><span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/rainbow_hcl.html">heat_hcl</a></span>(<span class="no">n</span>, <span class="kw">c</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">80</span>, <span class="fl">30</span>), <span class="kw">l</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">30</span>, <span class="fl">90</span>), <span class="kw">power</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>/<span class="fl">5</span>, <span class="fl">1.5</span>)))

<span class="co"># scaled_iris2 &lt;- iris2 %&gt;% as.matrix %&gt;% scale</span>
<span class="co"># library(gplots)</span>
<span class="kw pkg">gplots</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html">heatmap.2</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">iris2</span>),
          <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Heatmap for the Iris data set"</span>,
          <span class="kw">srtCol</span> <span class="kw">=</span> <span class="fl">20</span>,
          <span class="kw">dendrogram</span> <span class="kw">=</span> <span class="st">"row"</span>,
          <span class="kw">Rowv</span> <span class="kw">=</span> <span class="no">dend</span>,
          <span class="kw">Colv</span> <span class="kw">=</span> <span class="st">"NA"</span>, <span class="co"># this to make sure the columns are not ordered</span>
          <span class="kw">trace</span><span class="kw">=</span><span class="st">"none"</span>,
          <span class="kw">margins</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">0.1</span>),
          <span class="kw">key.xlab</span> <span class="kw">=</span> <span class="st">"Cm"</span>,
          <span class="kw">denscol</span> <span class="kw">=</span> <span class="st">"grey"</span>,
          <span class="kw">density.info</span> <span class="kw">=</span> <span class="st">"density"</span>,
          <span class="kw">RowSideColors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="../reference/labels_colors.html">labels_colors</a></span>(<span class="no">dend</span>)), <span class="co"># to add nice colored strips        </span>
          <span class="kw">col</span> <span class="kw">=</span> <span class="no">some_col_func</span>
         )</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-8-1.png" width="675"></p>
<p>We can get an interactive heatmap by using the <code>heatmaply</code> package/function: (code is not evaluated in order to keep the HTML size)</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="kw pkg">heatmaply</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/heatmaply/man/heatmaply.html">heatmaply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">iris2</span>),
          <span class="kw">dendrogram</span> <span class="kw">=</span> <span class="st">"row"</span>,
          <span class="kw">Rowv</span> <span class="kw">=</span> <span class="no">dend</span>)</pre></body></html></div>
</div>
<div id="similaritydifference-between-various-clustering-algorithms" class="section level3">
<h3 class="hasAnchor">
<a href="#similaritydifference-between-various-clustering-algorithms" class="anchor"></a>Similarity/difference between various clustering algorithms</h3>
<p>We may ask ourselves how many different results we could get if we would use different clustering algorithms (<code>hclust</code> has 8 different algorithms implemented). For the purpose of this analysis, we will create all 8 hclust objects, and chain them together into a single <code>dendlist</code> object (which, as the name implies, can hold a bunch of dendrograms together for the purpose of further analysis).</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">hclust_methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ward.D"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"average"</span>, <span class="st">"mcquitty"</span>,
        <span class="st">"median"</span>, <span class="st">"centroid"</span>, <span class="st">"ward.D2"</span>)
<span class="no">iris_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">hclust_methods</span>)) {
   <span class="no">hc_iris</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="no">d_iris</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">hclust_methods</span>[<span class="no">i</span>])
   <span class="no">iris_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="no">iris_dendlist</span>, <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span>(<span class="no">hc_iris</span>))
}
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">iris_dendlist</span>) <span class="kw">&lt;-</span> <span class="no">hclust_methods</span>
<span class="no">iris_dendlist</span></pre></body></html></div>
<pre><code>## $ward.D
## 'dendrogram' with 2 branches and 150 members total, at height 199.6205 
## 
## $single
## 'dendrogram' with 2 branches and 150 members total, at height 1.640122 
## 
## $complete
## 'dendrogram' with 2 branches and 150 members total, at height 7.085196 
## 
## $average
## 'dendrogram' with 2 branches and 150 members total, at height 4.062683 
## 
## $mcquitty
## 'dendrogram' with 2 branches and 150 members total, at height 4.497283 
## 
## $median
## 'dendrogram' with 2 branches and 150 members total, at height 2.82744 
## 
## $centroid
## 'dendrogram' with 2 branches and 150 members total, at height 2.994307 
## 
## $ward.D2
## 'dendrogram' with 2 branches and 150 members total, at height 32.44761 
## 
## attr(,"class")
## [1] "dendlist"</code></pre>
<p>Next, we can look at the cophenetic correlation between each clustering result using <code>cor.dendlist</code>. (This can be nicely plotted using the <code>corrplot</code> function from the <em>corrplot</em> package):</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">iris_dendlist_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">iris_dendlist</span>)
<span class="no">iris_dendlist_cor</span></pre></body></html></div>
<pre><code>##             ward.D    single  complete   average  mcquitty    median  centroid
## ward.D   1.0000000 0.9836838 0.5774013 0.9841333 0.9641103 0.9451815 0.9809088
## single   0.9836838 1.0000000 0.5665529 0.9681156 0.9329029 0.9444723 0.9903934
## complete 0.5774013 0.5665529 1.0000000 0.6195121 0.6107473 0.6889092 0.5870062
## average  0.9841333 0.9681156 0.6195121 1.0000000 0.9828015 0.9449422 0.9801444
## mcquitty 0.9641103 0.9329029 0.6107473 0.9828015 1.0000000 0.9203374 0.9499123
## median   0.9451815 0.9444723 0.6889092 0.9449422 0.9203374 1.0000000 0.9403569
## centroid 0.9809088 0.9903934 0.5870062 0.9801444 0.9499123 0.9403569 1.0000000
## ward.D2  0.9911648 0.9682507 0.6096286 0.9895131 0.9829977 0.9445832 0.9737886
##            ward.D2
## ward.D   0.9911648
## single   0.9682507
## complete 0.6096286
## average  0.9895131
## mcquitty 0.9829977
## median   0.9445832
## centroid 0.9737886
## ward.D2  1.0000000</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">iris_dendlist_cor</span>, <span class="st">"pie"</span>, <span class="st">"lower"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-11-1.png" width="600"></p>
<p>From the above figure, we can easily see that most clustering methods yield very similar results, except for the complete method (the default method in <code>hclust</code>), which yields a correlation measure of around 0.6.</p>
<p>The default cophenetic correlation uses pearson’s measure, but what if we use the spearman’s correlation coefficient?</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">iris_dendlist_cor_spearman</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">iris_dendlist</span>, <span class="kw">method_coef</span> <span class="kw">=</span> <span class="st">"spearman"</span>)
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">iris_dendlist_cor_spearman</span>, <span class="st">"pie"</span>, <span class="st">"lower"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-12-1.png" width="600"></p>
<p>We can see that the correlations are not so strong, indicating a behavior that is dependent on some items which are very distant from one another having an influence on the pearson’s correlation more than that of the spearman’s correlation.</p>
<p>To further explore the similarity and difference between the alternative clustering algorithms, we can turn to using the <code>tanglegram</code> function (which works for either two <code>dendrogram</code>s, or a <code>dendlist</code>).</p>
<p>First, let us see two methods which are very similar: ward.D vs ward.D2. From a first glance, we can see how they both give the same result for the top 3 clusters. However, since they are both ladderizes (i.e.: having their smaller branch rotated to be higher for each node), we can see that their clustering is not identical (due to the crossings).</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># The `which` parameter allows us to pick the elements in the list to compare</span>
<span class="no">iris_dendlist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">which</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">8</span>)) <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"branches_k_color"</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>) <span class="kw">%&gt;%</span>
   <span class="co"># untangle(method = "step1side", k_seq = 3:20) %&gt;%</span>
   <span class="co"># set("clear_branches") %&gt;% #otherwise the single lines are not black, since they retain the previous color from the branches_k_color.</span>
   <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">faster</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># (common_subtrees_color_branches = TRUE)</span></pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-13-1.png" width="450"></p>
<p>Next, let us look at two methods which also have a high cophenetic correlation: ward.D vs the average:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co"># The `which` parameter allows us to pick the elements in the list to compare</span>
<span class="no">iris_dendlist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">which</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">4</span>)) <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"branches_k_color"</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">2</span>) <span class="kw">%&gt;%</span>
   <span class="co"># untangle(method = "step1side", k_seq = 3:20) %&gt;%</span>
   <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">faster</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># (common_subtrees_color_branches = TRUE)</span></pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-14-1.png" width="450"></p>
<p>We see that when it comes to the major clusters, the two algorithms perform quite similarly.</p>
<p>However, how are they doing inside each of the clusters? It is quite difficult to compare the two because of the high value in ward.D. For comparison purposes, we can “rank” the heights of the branches in the two dendrograms (while still preserving their internal order). Next, we can highlight the shared common sub-trees (with different colors), and the distinct edges (with a dashed line):</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># The `which` parameter allows us to pick the elements in the list to compare</span>
<span class="no">iris_dendlist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">which</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">4</span>)) <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span>
   <span class="co"># untangle(method = "step1side", k_seq = 3:20) %&gt;%</span>
   <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"rank_branches"</span>) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">common_subtrees_color_branches</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-15-1.png" width="450"></p>
<p>We have 39 sub-trees that are identical between the two dendrograms:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="../reference/common_subtrees_clusters.html">common_subtrees_clusters</a></span>(<span class="no">iris_dendlist</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="no">iris_dendlist</span><span class="kw">[[</span><span class="fl">4</span>]]))[-<span class="fl">1</span>])</pre></body></html></div>
<pre><code>## [1] 39</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"># -1 at the end is because we are ignoring the "0" subtree, which indicates leaves that are singletons.</pre></body></html></div>
<p>What we can learn from this is that actually the two algorithms seem to give quite different results in the high resolution (higher cuts). However, since both capture the two major clusters (Setosa vs the others), they are considered quite similar by the cophenetic correlation.</p>
<p>But what about the “complete” method (that got a lower cophenetic correlation than the other methods)? When we compare “complete” vs “average”, we can quickly see that in the “complete” method, the splitting of the clusters is much more balanced, and mixes the “Setosa” species with another one. This is probably the cause for the big difference found in the cophenetic correlation between the “complete method” and the other clustering methods:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">iris_dendlist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">which</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">4</span>)) <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/untangle.html">untangle</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"step1side"</span>, <span class="kw">k_seq</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">6</span>) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"branches_k_color"</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">2</span>) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">faster</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># (common_subtrees_color_branches = TRUE)</span></pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-17-1.png" width="450"></p>
<p>We can quickly plot all 8 methods to see this phenomenon (i.e.: that “complete” has its smaller cluster larger than it is in all the other clustering methods):</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">2</span>))
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">8</span>) {
   <span class="no">iris_dendlist</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"branches_k_color"</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">2</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">horiz</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
   <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">iris_dendlist</span>)[<span class="no">i</span>])
}</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-18-1.png" width="450"></p>
<p>It seems that the cophenetic correlation is very biased towards the influence of the main clusters. Another correlation measure to use is the <code>cor_common_nodes</code> correlation (giving the proportion of nodes which share the exact same list of labels in both dendrograms). We can also check it out:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">iris_dendlist_cor2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">iris_dendlist</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"common"</span>)
<span class="no">iris_dendlist_cor2</span></pre></body></html></div>
<pre><code>##             ward.D    single  complete   average  mcquitty    median  centroid
## ward.D   1.0000000 0.7324415 0.8595318 0.8461538 0.8361204 0.7458194 0.7324415
## single   0.7324415 1.0000000 0.7324415 0.7491639 0.7458194 0.7591973 0.7625418
## complete 0.8595318 0.7324415 1.0000000 0.8060201 0.7993311 0.7491639 0.7290970
## average  0.8461538 0.7491639 0.8060201 1.0000000 0.8494983 0.7892977 0.7725753
## mcquitty 0.8361204 0.7458194 0.7993311 0.8494983 1.0000000 0.7859532 0.7759197
## median   0.7458194 0.7591973 0.7491639 0.7892977 0.7859532 1.0000000 0.8528428
## centroid 0.7324415 0.7625418 0.7290970 0.7725753 0.7759197 0.8528428 1.0000000
## ward.D2  0.8795987 0.7324415 0.8294314 0.8294314 0.8294314 0.7558528 0.7357860
##            ward.D2
## ward.D   0.8795987
## single   0.7324415
## complete 0.8294314
## average  0.8294314
## mcquitty 0.8294314
## median   0.7558528
## centroid 0.7357860
## ward.D2  1.0000000</code></pre>
<p>And plot it:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"># corrplot::corrplot(iris_dendlist_cor2, "pie", "lower")</pre></body></html></div>
<p>This gives us another perspective on our clustering algorithms. We can see that most methods have around 75% common nodes with one another. Centroid and median seem relatively close to one another, as well as ward.D2 and ward.D to one another and to complete, average, and mcquitty (as compared to the other methods).</p>
</div>
<div id="clustering-prediction-of-the-3-species-classes" class="section level3">
<h3 class="hasAnchor">
<a href="#clustering-prediction-of-the-3-species-classes" class="anchor"></a>Clustering prediction of the 3 species classes</h3>
<p>Lastly, we would like to see which of the different clustering algorithms came the closest to detecting the 3 flower species (when using a cut of k=3).</p>
<p>For this purpose, we compare the clustering solution of each algorithm with the real clusters, using the Fowlkes-Mallows Index (also using in the package for the <code>Bk_plot</code>). This measure is similar to rand (or rand adjusted) index, and gives a value of 1 when the two clusters confirm, and 0 when they do not.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">get_ordered_3_clusters</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">dend</span>) {
   <span class="fu"><a href="../reference/cutree-methods.html">cutree</a></span>(<span class="no">dend</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">3</span>)[<span class="fu"><a href="https://rdrr.io/r/stats/order.dendrogram.html">order.dendrogram</a></span>(<span class="no">dend</span>)]
}

<span class="no">dend_3_clusters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">iris_dendlist</span>, <span class="no">get_ordered_3_clusters</span>)

<span class="no">compare_clusters_to_iris</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">clus</span>) {<span class="fu"><a href="../reference/FM_index.html">FM_index</a></span>(<span class="no">clus</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">3</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fl">50</span>), <span class="kw">assume_sorted_vectors</span> <span class="kw">=</span> <span class="fl">TRUE</span>)}

<span class="no">clusters_performance</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">dend_3_clusters</span>, <span class="no">compare_clusters_to_iris</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/dotchart.html">dotchart</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">clusters_performance</span>), <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>,<span class="fl">1</span>),
         <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Fowlkes-Mallows Index (from 0 to 1)"</span>,
         <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Perormance of clustering algorithms \n in detecting the 3 species"</span>,
         <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">19</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-21-1.png" width="450"></p>
<p>We can see that the “median” method did the best, although similar results were achieved by ward.D2, average, ward.D, and mcquitty. However, the complete, centroid, and single method did worse in our case.</p>
</div>
<div id="conclusion" class="section level3">
<h3 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h3>
<p>The Iris data set is only 4-dimensional, making it possible to explore using pairs plot (SPLOM) or parallel coordinates plot. It is clear from these that two main clusters are visible, while the separation of the third cluster is difficult.</p>
<p>In the above analysis, we learned that the complete method fails to do the proper separation of the two main clusters when cut in k=2 (but succeeds in doing it, if moving to k=3 clusters). This is different from all the other 7 methods available in <code>hclust</code>, which do succeed in separating the 2 main clusters from the beginning (i.e.: for k=2).</p>
<p>We also noticed that all clustering algorithms share a relatively high proportion of common nodes (between 75% to 90%).</p>
<p>Lastly, when it came to trying to separating the flowers into 3 species, the median clustering method did the best, while the single method did the worst in this regard.</p>
<p>While the Iris data set is well known, I hope the above analysis was able to offer some new perspectives on the performance of the different hierarchical clustering methods.</p>
</div>
</div>
<div id="khan---microarray-gene-expression-data-set-from-khan-et-al--2001--subset-of-306-genes-" class="section level2">
<h2 class="hasAnchor">
<a href="#khan---microarray-gene-expression-data-set-from-khan-et-al--2001--subset-of-306-genes-" class="anchor"></a>khan - Microarray gene expression data set from Khan et al., 2001. Subset of 306 genes.</h2>
<div id="background-1" class="section level3">
<h3 class="hasAnchor">
<a href="#background-1" class="anchor"></a>Background</h3>
<blockquote>
<p>Khan contains gene expression profiles of four types of small, round, blue cell tumors of childhood (SRBCT) published by Khan et al. (2001). It also contains further gene annotation retrieved from SOURCE at <a href="http://source.stanford.edu/" class="uri">http://source.stanford.edu/</a>.</p>
</blockquote>
<p>This interesting data set offers two interesting items:</p>
<ul>
<li>train: data.frame of 306 rows and 64 columns. The training data set of 64 arrays and 306 gene expression values</li>
<li>test: data.frame, of 306 rows and 25 columns. The test data set of 25 arrays and 306 genes expression values</li>
</ul>
<p>This way we can create a hierarchical clustering on the 306 genes expression values on the train and the test data and compare the two to see the stability of the results.</p>
<p>We define the variables:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">train</span> <span class="kw">&lt;-</span> <span class="kw pkg">dendextend</span><span class="kw ns">::</span><span class="no"><a href="../reference/khan.html">khan</a></span>$<span class="no">train</span>
<span class="no">test</span> <span class="kw">&lt;-</span> <span class="kw pkg">dendextend</span><span class="kw ns">::</span><span class="no"><a href="../reference/khan.html">khan</a></span>$<span class="no">test</span></pre></body></html></div>
<p>And create the dendrograms:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">d_train</span> <span class="kw">&lt;-</span> <span class="no">train</span> <span class="kw">%&gt;%</span> <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="no">hclust</span> <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span>
<span class="no">d_test</span> <span class="kw">&lt;-</span> <span class="no">test</span> <span class="kw">%&gt;%</span> <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="no">hclust</span> <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span>
<span class="no">d_train_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">train</span> <span class="kw">=</span> <span class="no">d_train</span>, <span class="kw">test</span> <span class="kw">=</span> <span class="no">d_test</span>)</pre></body></html></div>
</div>
<div id="comparing-the-train-vs-test-dendrograms" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-the-train-vs-test-dendrograms" class="anchor"></a>Comparing the train vs test dendrograms</h3>
<p>Using a cophenetic correlation, we can see the two trees have some similarity (0.57):</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">d_train_test</span> <span class="kw">%&gt;%</span> <span class="no">cor.dendlist</span></pre></body></html></div>
<pre><code>##           train      test
## train 1.0000000 0.5708019
## test  0.5708019 1.0000000</code></pre>
<p>However, when looking at the cophenetic correlation with the spearman correlation coefficiant, the value is lower (0.49) indicating that some of the similarity is due to a small number of items, distant from the others, which are correlated similarly in the two trees:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">d_train_test</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="kw">method_coef</span> <span class="kw">=</span> <span class="st">"spearman"</span>)</pre></body></html></div>
<pre><code>##           train      test
## train 1.0000000 0.4971936
## test  0.4971936 1.0000000</code></pre>
<p>We may ask at which level of cutting the dendrogram we get the “best” level of similarity. For this we may turn to the Bk plot. The plots shows us that at around 7 clusters the groups in the two are starting to look significantly similar. (Note that significantly does not mean substantially)</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="../reference/Bk_plot.html">Bk_plot</a></span>(<span class="no">d_train</span>, <span class="no">d_test</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">30</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">30</span>))</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-26-1.png" width="450"></p>
<p>Next, we compare the results with a tanglegram. We make sure to color the connecting line with the colors of the branches of the train (left) dendrogram. This can help us see which patterns are somewhat preserved between the two trees.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">pre_tang_d_train_test</span> <span class="kw">&lt;-</span> <span class="no">d_train_test</span> <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span> <span class="co"># untangle %&gt;%</span>
   <span class="fu"><a href="../reference/set.html">set</a></span>(<span class="st">"branches_k_color"</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">7</span>)
<span class="no">train_branches_colors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_leaves_branches_col.html">get_leaves_branches_col</a></span>(<span class="no">pre_tang_d_train_test</span>$<span class="no">train</span>)
<span class="no">pre_tang_d_train_test</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">fast</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">color_lines</span> <span class="kw">=</span> <span class="no">train_branches_colors</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-27-1.png" width="600"></p>
<p>We can see that the top most (small) cluster is somewhat preserved between the two trees. However, a large spaghetti-like tangle of lines is indicating that the two trees are far from being identical.</p>
<p>If we look only at subtrees of the two dendrograms so that they include only genes that are clustered with genes in both trees, we get only 14 genes (while the original trees had 306 genes). We can see how we have several groups of pairs of genes, and one group with four genes clustered together in both trees:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># This was calculated before</span>
<span class="co"># d_train_test_common &lt;- d_train_test %&gt;% prune_common_subtrees.dendlist</span>
<span class="co"># d_train_test_common</span>
<span class="no">d_train_test_common</span> <span class="kw">%&gt;%</span> <span class="no">untangle</span> <span class="kw">%&gt;%</span>  <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">common_subtrees_color_branches</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-29-1.png" width="450"></p>
<p>Trees’ sizes:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">d_train_test</span> <span class="kw">%&gt;%</span> <span class="no">nleaves</span></pre></body></html></div>
<pre><code>## train  test 
##   306   306</code></pre>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">d_train_test_common</span> <span class="kw">%&gt;%</span> <span class="no">nleaves</span></pre></body></html></div>
<pre><code>## train  test 
##    14    14</code></pre>
</div>
<div id="conclusion-1" class="section level3">
<h3 class="hasAnchor">
<a href="#conclusion-1" class="anchor"></a>Conclusion</h3>
<p>To conclude: we see that the clustering algorithm resulted in trees which are significantly similar in both the training and the test data sets beyond chance, but that this similarity is restricted to only a very small proportion of genes.</p>
</div>
</div>
<div id="votes-repub---votes-for-republican-candidate-in-presidential-elections" class="section level2">
<h2 class="hasAnchor">
<a href="#votes-repub---votes-for-republican-candidate-in-presidential-elections" class="anchor"></a>votes.repub - Votes for Republican Candidate in Presidential Elections</h2>
<div id="background-2" class="section level3">
<h3 class="hasAnchor">
<a href="#background-2" class="anchor"></a>Background</h3>
<blockquote>
<p>This is a data frame with the percentage of votes given to the republican candidate in presidential elections from 1856 to 1976. Rows represent the 50 states, and columns the 31 elections.</p>
</blockquote>
<blockquote>
<p>Source: S. Peterson (1973): A Statistical History of the American Presidential Elections. New York: Frederick Ungar Publishing Co. Data from 1964 to 1976 is from R. M. Scammon, American Votes 12, Congressional Quarterly.</p>
</blockquote>
<p>Define variables:</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">votes.repub</span> <span class="kw">&lt;-</span> <span class="kw pkg">cluster</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/cluster/man/votes.repub.html">votes.repub</a></span></pre></body></html></div>
<p>These data can be visualized using a (costumed made) parallel coordinates plot:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">years</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"X"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">votes.repub</span>)))

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">las</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.5</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>) + <span class="fl">0.1</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">.8</span>)
<span class="co"># MASS::parcoord(votes.repub, var.label = FALSE, lwd = 1)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span>(<span class="fl">1L</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">votes.repub</span>), <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">votes.repub</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>,
        <span class="kw">axes</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">years</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="no">years</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">2</span>)
<span class="co"># Add Title</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Votes for Republican Candidate\n in Presidential Elections \n (each line is a country - over the years)"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-32-1.png" width="450"></p>
</div>
<div id="heatmap" class="section level3">
<h3 class="hasAnchor">
<a href="#heatmap" class="anchor"></a>Heatmap</h3>
<p>This is a nice example when the parallel coordinates plot has some serious limitations: it does not help us detect the states, we fail to see the missing value patterns, and it is tricky to see clusters in general (due to the large number of threads).</p>
<p>For these data, it can be quite helpful to see a heatmap of the votes across the years. The ordering of the rows is tricky. First, the distance of the vectors (later used for the clustering) should be done after transformation (since we are dealing with proportion of votes). In this case, I used the arcsin transformation (a logit transformation could also work, but the arcsin is safer for dealing with 0/1 observations). But given the clusters, we wish to order the leaves (as much as possible), in order to take into account the missing value clusterings. So we, in fact, have two clusters, one for the raw values, and another for the “shadow matrix” (i.e.: the matrix with 0/1, indicating if a value was missing or not).</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">arcsin_transformation</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">asin</a></span>(<span class="no">x</span>/<span class="fl">100</span>)

<span class="no">dend_NA</span> <span class="kw">&lt;-</span> <span class="no">votes.repub</span> <span class="kw">%&gt;%</span> <span class="no">is.na</span> <span class="kw">%&gt;%</span>
   <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="no">hclust</span> <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span> <span class="no">ladderize</span>

<span class="no">dend</span> <span class="kw">&lt;-</span> <span class="no">votes.repub</span> <span class="kw">%&gt;%</span> <span class="no">arcsin_transformation</span> <span class="kw">%&gt;%</span>
   <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"com"</span>) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">dend_NA</span>)) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>)

<span class="co"># some_col_func &lt;- function(n) rev(colorspace::heat_hcl(n, c = c(80, 30), l = c(30, 90), power = c(1/5, 1.5)))</span>
<span class="no">some_col_func</span> <span class="kw">&lt;-</span> <span class="kw pkg">colorspace</span><span class="kw ns">::</span><span class="no"><a href="http://colorspace.R-Forge.R-project.org//reference/hcl_palettes.html">diverge_hcl</a></span>


<span class="co"># par(mar = c(3,3,3,3))</span>
<span class="co"># library(gplots)</span>
<span class="kw pkg">gplots</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html">heatmap.2</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">votes.repub</span>),
          <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Votes for\n Republican Presidential Candidate\n (clustered using complete)"</span>,
          <span class="kw">srtCol</span> <span class="kw">=</span> <span class="fl">60</span>,
          <span class="kw">dendrogram</span> <span class="kw">=</span> <span class="st">"row"</span>,
          <span class="kw">Rowv</span> <span class="kw">=</span> <span class="no">dend</span>,
          <span class="kw">Colv</span> <span class="kw">=</span> <span class="st">"NA"</span>, <span class="co"># this to make sure the columns are not ordered</span>
          <span class="kw">trace</span><span class="kw">=</span><span class="st">"none"</span>,
          <span class="kw">margins</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">6</span>),
          <span class="kw">key.xlab</span> <span class="kw">=</span> <span class="st">"% Votes for Republican\n Presidential Candidate"</span>,
          <span class="kw">labCol</span> <span class="kw">=</span> <span class="no">years</span>,
          <span class="kw">denscol</span> <span class="kw">=</span> <span class="st">"grey"</span>,
          <span class="kw">density.info</span> <span class="kw">=</span> <span class="st">"density"</span>,
          <span class="kw">col</span> <span class="kw">=</span> <span class="no">some_col_func</span>
         )</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-33-1.png" width="675"></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r">          # RowSideColors = rev(labels_colors(dend)), # to add nice colored strips      </pre></body></html></div>
<p>How much of a difference would we get if we used another clustering algorithm?</p>
<p>We first calculate the clustering using 8 different methods:</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">hclust_methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ward.D"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"average"</span>, <span class="st">"mcquitty"</span>,
        <span class="st">"median"</span>, <span class="st">"centroid"</span>, <span class="st">"ward.D2"</span>)
<span class="no">votes.repub_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>()

<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">hclust_methods</span>)) {
   <span class="no">tmp_dend</span> <span class="kw">&lt;-</span> <span class="no">votes.repub</span> <span class="kw">%&gt;%</span> <span class="no">arcsin_transformation</span> <span class="kw">%&gt;%</span> <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="no">hclust_methods</span>[<span class="no">i</span>]) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span>
   <span class="no">votes.repub_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="no">votes.repub_dendlist</span>, <span class="no">tmp_dend</span>)
}
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">votes.repub_dendlist</span>) <span class="kw">&lt;-</span> <span class="no">hclust_methods</span>
<span class="co"># votes.repub_dendlist</span></pre></body></html></div>
<p>Next, we can look at the cophenetic correlation between each clustering result using <code>cor.dendlist</code>. (This can be nicely plotted using the <code>corrplot</code> function from the <em>corrplot</em> package):</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">votes.repub_dendlist</span>), <span class="st">"pie"</span>, <span class="st">"lower"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-35-1.png" width="600"></p>
<p>We see that the “complete” method is somewhat similar to the ward.D/ward.D2 methods, but there is less similarity with the other methods. We can see that the methods “average”, “mcquitty” and “median”, all give somewhat similar results. So by using “average”, we will see an alternative presentation that represents (in a sense) three other clustering solutions.</p>
<p>We can look at the heatmap of the “average” method. However, as you can see, it is not very helpful in seeing the difference between the two clustering solutions.</p>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-36-1.png" width="675"></p>
<p>Let’s look at the tanglegram of the two methods to get a better insight into the differences between the two:</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="no">dend_com</span> <span class="kw">&lt;-</span> <span class="no">votes.repub</span> <span class="kw">%&gt;%</span> <span class="no">arcsin_transformation</span> <span class="kw">%&gt;%</span>
   <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"com"</span>) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">dend_NA</span>)) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>) <span class="co"># %&gt;% ladderize</span>
<span class="no">dend_ave</span> <span class="kw">&lt;-</span> <span class="no">votes.repub</span> <span class="kw">%&gt;%</span> <span class="no">arcsin_transformation</span> <span class="kw">%&gt;%</span>
   <span class="no">dist</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"ave"</span>) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">dend_NA</span>)) <span class="kw">%&gt;%</span>
   <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>) <span class="co"># %&gt;% ladderize</span>

<span class="co"># The orders were predefined after using untangle("step2side")</span>
<span class="co"># They are omitted here to save running time.</span>
<span class="no">dend_com</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="no">dend_com</span>, <span class="no">ord1</span>)
<span class="no">dend_ave</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/rotate.html">rotate</a></span>(<span class="no">dend_ave</span>, <span class="no">ord2</span>)

<span class="no">dends</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="kw">complete</span> <span class="kw">=</span> <span class="no">dend_com</span>, <span class="kw">average</span> <span class="kw">=</span> <span class="no">dend_ave</span>) <span class="co"># %&gt;% untangle("step2side")</span>
<span class="no">dends</span>  <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/tanglegram.html">tanglegram</a></span>(<span class="kw">margin_inner</span> <span class="kw">=</span> <span class="fl">7</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-38-1.png" width="450"></p>
<p>We see that the two clusterings give similar results for: “Alabama”, “Georgia”, “Louisiana”, “Arkansas”, “Florida”, “Texas”, “South Carolina”, “Mississippi”.</p>
<p>There are also several other sub-trees which are identical between the two methods. The biggest difference lies in several “rouge” states that are placed differently in the two clustering algorithms. They are: Vermont, Michigan, Maine, Hawaii, New Jersey, West Virginia, and Oklahoma.</p>
<p>A better understanding of the data requires a much more in-depth historical perspective than is within the scope of the current analysis.</p>
</div>
</div>
<div id="animals---attributes-of-animals" class="section level2">
<h2 class="hasAnchor">
<a href="#animals---attributes-of-animals" class="anchor"></a>animals - Attributes of Animals</h2>
<div id="background-3" class="section level3">
<h3 class="hasAnchor">
<a href="#background-3" class="anchor"></a>Background</h3>
<blockquote>
<p>This data set considers 6 binary attributes for 20 animals.</p>
</blockquote>
<blockquote>
<p>see Struyf, Hubert &amp; Rousseeuw (1996), in agnes.</p>
</blockquote>
<p>Define variables:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">animals</span> <span class="kw">&lt;-</span> <span class="kw pkg">cluster</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/cluster/man/animals.html">animals</a></span>

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">animals</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"warm-blooded"</span>,
                       <span class="st">"can fly"</span>,
                       <span class="st">"vertebrate"</span>,
                       <span class="st">"endangered"</span>,
                       <span class="st">"live in groups"</span>,
                       <span class="st">"have hair"</span>)</pre></body></html></div>
</div>
<div id="heatmap-1" class="section level3">
<h3 class="hasAnchor">
<a href="#heatmap-1" class="anchor"></a>Heatmap</h3>
<p>This is a good example for using a heatmap + colored branches.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">dend_r</span> <span class="kw">&lt;-</span> <span class="no">animals</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"man"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"ward.D"</span>) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span> <span class="no">ladderize</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="kw">k</span><span class="kw">=</span><span class="fl">4</span>)

<span class="no">dend_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">animals</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"man"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"com"</span>) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span> <span class="kw">%&gt;%</span> <span class="no">ladderize</span><span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/color_branches.html">color_branches</a></span>(<span class="kw">k</span><span class="kw">=</span><span class="fl">3</span>)


<span class="co"># some_col_func &lt;- function(n) rev(colorspace::heat_hcl(n, c = c(80, 30), l = c(30, 90), power = c(1/5, 1.5)))</span>
<span class="co"># some_col_func &lt;- colorspace::diverge_hcl</span>
<span class="co"># some_col_func &lt;- colorspace::sequential_hcl</span>
<span class="no">some_col_func</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">n</span>) (<span class="kw pkg">colorspace</span><span class="kw ns">::</span><span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/hcl_palettes.html">diverge_hcl</a></span>(<span class="no">n</span>, <span class="kw">h</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">246</span>, <span class="fl">40</span>), <span class="kw">c</span> <span class="kw">=</span> <span class="fl">96</span>, <span class="kw">l</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">65</span>, <span class="fl">90</span>)))



<span class="co"># par(mar = c(3,3,3,3))</span>
<span class="co"># library(gplots)</span>
<span class="kw pkg">gplots</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html">heatmap.2</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">animals</span>-<span class="fl">1</span>),
          <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Attributes of Animals"</span>,
          <span class="kw">srtCol</span> <span class="kw">=</span> <span class="fl">35</span>,
          <span class="kw">Rowv</span> <span class="kw">=</span> <span class="no">dend_r</span>,
          <span class="kw">Colv</span> <span class="kw">=</span> <span class="no">dend_c</span>,
          <span class="kw">trace</span><span class="kw">=</span><span class="st">"row"</span>, <span class="kw">hline</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">tracecol</span> <span class="kw">=</span> <span class="st">"darkgrey"</span>,
          <span class="kw">margins</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>,<span class="fl">3</span>),
          <span class="kw">key.xlab</span> <span class="kw">=</span> <span class="st">"no / yes"</span>,
          <span class="kw">denscol</span> <span class="kw">=</span> <span class="st">"grey"</span>,
          <span class="kw">density.info</span> <span class="kw">=</span> <span class="st">"density"</span>,
          <span class="kw">col</span> <span class="kw">=</span> <span class="no">some_col_func</span>
         )</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-40-1.png" width="675"></p>
<p>We see that we have several groups of variables: the “can fly” and “endangered” (which usually are both “no”), the “have hair”, and the “warm-blooded”, “vertebrate”, and “live in groups”.</p>
<p>We see that within the animals there are (roughly!) the following 4 groups:</p>
<ol style="list-style-type: decimal">
<li>The cold-blooded non-vertebrates, which are mostly not endangered.</li>
<li>The warm-blooded vertebrates, which live in groups, have hair, cannot fly, and mostly are not endangered.</li>
<li>The cold-blooded vertebrates, without hair, cannot fly, and are not endangered.</li>
<li>The (mostly) warm-blooded vertebrates, without hair, some can fly, and some are endangered.</li>
</ol>
<p>How much of a difference would we get if we used another clustering algorithm?</p>
<p>We first calculate the clustering using 8 different methods:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">hclust_methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ward.D"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"average"</span>, <span class="st">"mcquitty"</span>,
        <span class="st">"median"</span>, <span class="st">"centroid"</span>, <span class="st">"ward.D2"</span>)
<span class="no">animals_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>()

<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">hclust_methods</span>)) {
   <span class="no">tmp_dend</span> <span class="kw">&lt;-</span>  <span class="no">animals</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"man"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="no">hclust_methods</span>[<span class="no">i</span>]) <span class="kw">%&gt;%</span> <span class="no">as.dendrogram</span>
   <span class="no">animals_dendlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="no">animals_dendlist</span>, <span class="no">tmp_dend</span>)
}
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">animals_dendlist</span>) <span class="kw">&lt;-</span> <span class="no">hclust_methods</span>
<span class="co"># votes.repub_dendlist</span></pre></body></html></div>
<p>Next, we can look at the cophenetic correlation between each clustering result using <code>cor.dendlist</code> (This can be nicely plotted using the <code>corrplot</code> function from the <em>corrplot</em> package):</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">cophenetic_cors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">animals_dendlist</span>)
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">cophenetic_cors</span>, <span class="st">"pie"</span>, <span class="st">"lower"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-42-1.png" width="600"></p>
<p>We see that the different methods (other than ward.D and ward.D2), all give quite different results. So would the above analysis be different if we had used another clustering algorithm?</p>
<p>For this purpose, we compare the clustering solution of each algorithm with one another, when cut to k=4 clusters, using the Fowlkes-Mallows Index. This measure is similar to rand (or rand adjusted) index, and gives a value of 1 when the two clusters conform, and 0 when they do not:</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">remove_median</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dendlist.html">dendlist</a></span>(<span class="no">animals_dendlist</span>, <span class="kw">which</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">8</span>)[-<span class="fl">6</span>] )
<span class="no">FM_cors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor.dendlist.html">cor.dendlist</a></span>(<span class="no">remove_median</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"FM_index"</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">FM_cors</span>, <span class="st">"pie"</span>, <span class="st">"lower"</span>)</pre></body></html></div>
<p><img src="Cluster_Analysis_files/figure-html/unnamed-chunk-43-1.png" width="450"></p>
<p>We removed the “median” method since it did not have k=4 possible. In general, the results seems sensitive to the algorithm used, and the different algorithm methods do not seem to agree with one another (with regards to k=4), so further analyses may be in place in order to decide on which algorithm and interpretation are most appropriate for these data.</p>
<p>(Other possible data sets for the future: chorSub, flower, plantTraits, pluton, ruspini, agriculture)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tal Galili, Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
